# wplacegrasswonder.memorial Web å®æ–½è®¡åˆ’

> åŸºäº plan.md çš„åˆ†é˜¶æ®µè¯¦ç»†æ‰§è¡Œæ–¹æ¡ˆ
>
> ç”Ÿæˆæ—¥æœŸï¼š2025-11-10

---

## ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è§ˆ)
- [å½“å‰çŠ¶æ€åˆ†æ](#å½“å‰çŠ¶æ€åˆ†æ)
- [é˜¶æ®µåˆ’åˆ†æ€»è§ˆ](#é˜¶æ®µåˆ’åˆ†æ€»è§ˆ)
- [é˜¶æ®µ 1: åŸºç¡€è®¾æ–½æ­å»º](#é˜¶æ®µ-1-åŸºç¡€è®¾æ–½æ­å»º)
- [é˜¶æ®µ 2: ç”¨æˆ·ç³»ç»Ÿ](#é˜¶æ®µ-2-ç”¨æˆ·ç³»ç»Ÿ)
- [é˜¶æ®µ 3: çºªå¿µé¡µæ ¸å¿ƒåŠŸèƒ½](#é˜¶æ®µ-3-çºªå¿µé¡µæ ¸å¿ƒåŠŸèƒ½)
- [é˜¶æ®µ 4: å½©è™¹æ¡¥æ•…äº‹å¢™](#é˜¶æ®µ-4-å½©è™¹æ¡¥æ•…äº‹å¢™)
- [é˜¶æ®µ 5: å†…å®¹ç®¡ç†ä¸ä¼˜åŒ–](#é˜¶æ®µ-5-å†…å®¹ç®¡ç†ä¸ä¼˜åŒ–)
- [æ¯ä¸ªé˜¶æ®µçš„æ£€æŸ¥æ¸…å•](#æ£€æŸ¥æ¸…å•)

---

## é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: wplacegrasswonder.memorial
**é¡¹ç›®ç±»å‹**: å® ç‰©çºªå¿µç½‘ç«™å¹³å°
**æŠ€æœ¯æ ˆ**: Next.js 16 + TypeScript + Tailwind CSS + Supabase
**ç›®æ ‡**: ä¸ºå¤±å»å® ç‰©çš„ä¸»äººæä¾›æ¸©æš–ã€å°Šé‡ã€æ°¸ä¹…çš„çºªå¿µç©ºé—´

**æ ¸å¿ƒä»·å€¼**:
- æƒ…æ„ŸåŒ–è®¾è®¡ - å…±æƒ…è‡³ä¸Š
- ä¸“ä¸šçš„çºªå¿µå¹³å° - æ¯”ç¤¾äº¤åª’ä½“æ›´æœ‰é’ˆå¯¹æ€§
- ç¤¾åŒºæ”¯æŒ - æ¸è¿›å¼æ„å»º

---

## å½“å‰çŠ¶æ€åˆ†æ

**å·²å®Œæˆ**:
- âœ… Next.js 16 é¡¹ç›®åˆå§‹åŒ–
- âœ… TypeScript é…ç½®
- âœ… Tailwind CSS 4.0 é…ç½®
- âœ… åŸºç¡€é¡¹ç›®ç»“æ„
- âœ… Git ä»“åº“å’Œåˆ†æ”¯è®¾ç½®

**å¾…å®Œæˆ**:
- âŒ æ•°æ®åº“è®¾è®¡ä¸é…ç½®
- âŒ è®¤è¯ç³»ç»Ÿ
- âŒ UI ç»„ä»¶åº“
- âŒ æ ¸å¿ƒåŠŸèƒ½å¼€å‘
- âŒ SEO ä¼˜åŒ–

**æŠ€æœ¯å€ºåŠ¡/æ³¨æ„äº‹é¡¹**:
- éœ€è¦é…ç½® Supabase åç«¯æœåŠ¡
- éœ€è¦è®¾è®¡æƒ…æ„ŸåŒ–çš„ UI/UX ç³»ç»Ÿ
- éœ€è¦è€ƒè™‘åª’ä½“æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ

---

## é˜¶æ®µåˆ’åˆ†æ€»è§ˆ

```
é˜¶æ®µ 1: åŸºç¡€è®¾æ–½æ­å»º (3-5 å¤©)
  â”œâ”€â”€ è®¾è®¡ç³»ç»Ÿå®šä¹‰
  â”œâ”€â”€ Supabase é…ç½®
  â”œâ”€â”€ æ•°æ®åº“ Schema
  â””â”€â”€ UI ç»„ä»¶åº“æ­å»º

é˜¶æ®µ 2: ç”¨æˆ·ç³»ç»Ÿ (5-7 å¤©)
  â”œâ”€â”€ è®¤è¯åŠŸèƒ½
  â”œâ”€â”€ ç”¨æˆ· Dashboard
  â””â”€â”€ è´¦æˆ·ç®¡ç†

é˜¶æ®µ 3: çºªå¿µé¡µæ ¸å¿ƒåŠŸèƒ½ (10-14 å¤©)
  â”œâ”€â”€ çºªå¿µé¡µåˆ›å»ºæµç¨‹
  â”œâ”€â”€ ç…§ç‰‡ä¸Šä¼ 
  â”œâ”€â”€ çºªå¿µé¡µå±•ç¤º
  â”œâ”€â”€ è™šæ‹Ÿæ‚¼å¿µäº’åŠ¨
  â””â”€â”€ ç•™è¨€åŠŸèƒ½

é˜¶æ®µ 4: å½©è™¹æ¡¥æ•…äº‹å¢™ (5-7 å¤©)
  â”œâ”€â”€ é¦–é¡µè®¾è®¡
  â”œâ”€â”€ ç€‘å¸ƒæµå¸ƒå±€
  â”œâ”€â”€ æ’åºè¿‡æ»¤
  â””â”€â”€ æ— é™æ»šåŠ¨

é˜¶æ®µ 5: å†…å®¹ç®¡ç†ä¸ä¼˜åŒ– (5-7 å¤©)
  â”œâ”€â”€ SEO ä¼˜åŒ–
  â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
  â”œâ”€â”€ å†…å®¹å®¡æ ¸
  â””â”€â”€ æµ‹è¯•éƒ¨ç½²
```

**æ€»é¢„è®¡æ—¶é—´**: 28-40 å¤© (çº¦ 6-8 å‘¨)

---

## é˜¶æ®µ 1: åŸºç¡€è®¾æ–½æ­å»º

**ç›®æ ‡**: å»ºç«‹é¡¹ç›®åŸºç¡€æ¶æ„ï¼Œå®šä¹‰è®¾è®¡ç³»ç»Ÿï¼Œé…ç½®åç«¯æœåŠ¡

**æ—¶é—´ä¼°ç®—**: 3-5 å¤©

### 1.1 è®¾è®¡ç³»ç»Ÿå®šä¹‰

#### ä»»åŠ¡æ¸…å•

**è‰²å½©ç³»ç»Ÿå®šä¹‰**:
```typescript
// src/lib/design-tokens.ts
export const colors = {
  // ä¸»è‰²è°ƒ - æ¸©æš–æŸ”å’Œ
  primary: {
    50: '#E3F2FD',   // æµ…è“ - å¹³é™
    100: '#F3E5F5',  // æ·¡ç´« - æ¸©æŸ”
    200: '#FCE4EC',  // æŸ”ç²‰ - æ¸©æš–
    300: '#FFF3E0',  // ç±³ç™½ - çº¯å‡€
  },
  // ä¸­æ€§è‰²
  neutral: {
    50: '#FAFAFA',
    100: '#F5F5F5',
    800: '#333333',  // æ·±ç°ï¼ˆé¿å…çº¯é»‘ï¼‰
    900: '#1A1A1A',
  },
  // åŠŸèƒ½è‰²
  success: '#81C784',
  warning: '#FFB74D',
  error: '#E57373',   // æŸ”å’Œçš„çº¢è‰²ï¼ˆéåˆºçœ¼ï¼‰
}
```

**å­—ä½“ç³»ç»Ÿ**:
```typescript
export const typography = {
  fonts: {
    sans: 'Inter, system-ui, sans-serif',
    display: 'Inter, sans-serif',
  },
  sizes: {
    xs: '0.75rem',   // 12px
    sm: '0.875rem',  // 14px
    base: '1.125rem', // 18px (åŸºå‡† - æ˜“è¯»)
    lg: '1.25rem',   // 20px
    xl: '1.5rem',    // 24px
    '2xl': '2rem',   // 32px
    '3xl': '2.5rem', // 40px
  },
  lineHeight: {
    tight: '1.4',
    normal: '1.6',  // é»˜è®¤
    relaxed: '1.8', // æ˜“è¯»
  }
}
```

**é—´è·ç³»ç»Ÿ**:
```typescript
export const spacing = {
  xs: '0.5rem',   // 8px
  sm: '1rem',     // 16px
  md: '1.5rem',   // 24px
  lg: '2rem',     // 32px
  xl: '3rem',     // 48px
  '2xl': '4rem',  // 64px
}

export const borderRadius = {
  sm: '0.5rem',   // 8px
  md: '0.75rem',  // 12px - é»˜è®¤æŸ”å’Œæ„Ÿ
  lg: '1rem',     // 16px
  full: '9999px',
}
```

**äº§å‡ºæ–‡ä»¶**:
- [ ] `src/lib/design-tokens.ts` - è®¾è®¡ Token
- [ ] `tailwind.config.ts` - æ›´æ–°é…ç½®ä½¿ç”¨è‡ªå®šä¹‰ Token
- [ ] `.claude/design-system.md` - è®¾è®¡ç³»ç»Ÿæ–‡æ¡£

---

### 1.2 Supabase é…ç½®

#### ä»»åŠ¡æ¸…å•

**Supabase é¡¹ç›®è®¾ç½®**:
- [ ] åœ¨ Supabase åˆ›å»ºæ–°é¡¹ç›®
- [ ] è·å–é¡¹ç›® URL å’Œ anon key
- [ ] é…ç½®ç¯å¢ƒå˜é‡

**ç¯å¢ƒå˜é‡é…ç½®**:
```bash
# .env.local
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

**Supabase å®¢æˆ·ç«¯é…ç½®**:
- [ ] å®‰è£…ä¾èµ–: `npm install @supabase/supabase-js @supabase/ssr`
- [ ] åˆ›å»º Supabase å®¢æˆ·ç«¯å·¥å…·æ–‡ä»¶

**äº§å‡ºæ–‡ä»¶**:
```typescript
// src/lib/supabase/client.ts
import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}

// src/lib/supabase/server.ts
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createServerSupabaseClient() {
  const cookieStore = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return cookieStore.get(name)?.value
        },
      },
    }
  )
}
```

---

### 1.3 æ•°æ®åº“ Schema è®¾è®¡

#### æ•°æ®åº“è¡¨ç»“æ„

**æ ¸å¿ƒè¡¨è®¾è®¡**:

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(100),
  avatar_url TEXT,
  subscription_tier VARCHAR(20) DEFAULT 'free', -- free/personal/lifetime
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å¯ç”¨ RLS (Row Level Security)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- ç”¨æˆ·åªèƒ½è¯»å–è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can view own data" ON users
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own data" ON users
  FOR UPDATE USING (auth.uid() = id);

-- çºªå¿µé¡µè¡¨
CREATE TABLE memorials (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  pet_name VARCHAR(100) NOT NULL,
  pet_breed VARCHAR(100),
  pet_species VARCHAR(50), -- dog/cat/bird/other
  birth_date DATE,
  death_date DATE,
  bio TEXT, -- ç”Ÿå¹³æ•…äº‹
  memorial_text TEXT, -- çºªå¿µæ–‡
  slug VARCHAR(255) UNIQUE, -- URL slug
  privacy VARCHAR(20) DEFAULT 'public', -- public/private/unlisted
  template_id INT DEFAULT 1,
  view_count INT DEFAULT 0,
  candle_count INT DEFAULT 0,
  flower_count INT DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE memorials ENABLE ROW LEVEL SECURITY;

-- å…¬å¼€çºªå¿µé¡µä»»ä½•äººå¯è§
CREATE POLICY "Public memorials are viewable by everyone" ON memorials
  FOR SELECT USING (privacy = 'public');

-- ç§å¯†çºªå¿µé¡µä»…åˆ›å»ºè€…å¯è§
CREATE POLICY "Users can view own memorials" ON memorials
  FOR SELECT USING (auth.uid() = user_id);

-- ç”¨æˆ·å¯ä»¥åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è‡ªå·±çš„çºªå¿µé¡µ
CREATE POLICY "Users can insert own memorials" ON memorials
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own memorials" ON memorials
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own memorials" ON memorials
  FOR DELETE USING (auth.uid() = user_id);

-- ç…§ç‰‡è¡¨
CREATE TABLE photos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  memorial_id UUID REFERENCES memorials(id) ON DELETE CASCADE,
  url TEXT NOT NULL,
  thumbnail_url TEXT,
  caption TEXT,
  display_order INT DEFAULT 0,
  uploaded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE photos ENABLE ROW LEVEL SECURITY;

-- ç…§ç‰‡éšçºªå¿µé¡µæƒé™
CREATE POLICY "Photos are viewable if memorial is viewable" ON photos
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM memorials
      WHERE memorials.id = photos.memorial_id
      AND (memorials.privacy = 'public' OR memorials.user_id = auth.uid())
    )
  );

CREATE POLICY "Users can manage photos in own memorials" ON photos
  FOR ALL USING (
    EXISTS (
      SELECT 1 FROM memorials
      WHERE memorials.id = photos.memorial_id
      AND memorials.user_id = auth.uid()
    )
  );

-- ç•™è¨€è¡¨
CREATE TABLE tributes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  memorial_id UUID REFERENCES memorials(id) ON DELETE CASCADE,
  author_name VARCHAR(100),
  author_email VARCHAR(255),
  author_id UUID REFERENCES users(id) ON DELETE SET NULL, -- å¦‚æœæ˜¯æ³¨å†Œç”¨æˆ·
  message TEXT NOT NULL,
  tribute_type VARCHAR(20) DEFAULT 'message', -- message/candle/flower
  flower_type VARCHAR(50), -- rose/lily/chrysanthemum/tulip
  is_approved BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE tributes ENABLE ROW LEVEL SECURITY;

-- å·²æ‰¹å‡†çš„ç•™è¨€ä»»ä½•äººå¯è§
CREATE POLICY "Approved tributes are viewable by everyone" ON tributes
  FOR SELECT USING (is_approved = true);

-- çºªå¿µé¡µåˆ›å»ºè€…å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç•™è¨€ï¼ˆåŒ…æ‹¬å¾…å®¡æ ¸ï¼‰
CREATE POLICY "Memorial owners can view all tributes" ON tributes
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM memorials
      WHERE memorials.id = tributes.memorial_id
      AND memorials.user_id = auth.uid()
    )
  );

-- ä»»ä½•äººå¯ä»¥åˆ›å»ºç•™è¨€ï¼ˆä½†é»˜è®¤æœªæ‰¹å‡†ï¼‰
CREATE POLICY "Anyone can create tributes" ON tributes
  FOR INSERT WITH CHECK (true);

-- è®¢é˜…è¡¨
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  plan VARCHAR(20), -- personal/lifetime
  status VARCHAR(20) DEFAULT 'active', -- active/cancelled/expired
  started_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  expires_at TIMESTAMP WITH TIME ZONE,
  stripe_subscription_id VARCHAR(255),
  stripe_customer_id VARCHAR(255),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own subscriptions" ON subscriptions
  FOR SELECT USING (auth.uid() = user_id);

-- åˆ›å»ºç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_memorials_user_id ON memorials(user_id);
CREATE INDEX idx_memorials_slug ON memorials(slug);
CREATE INDEX idx_memorials_privacy ON memorials(privacy);
CREATE INDEX idx_memorials_created_at ON memorials(created_at DESC);
CREATE INDEX idx_photos_memorial_id ON photos(memorial_id);
CREATE INDEX idx_tributes_memorial_id ON tributes(memorial_id);
CREATE INDEX idx_tributes_is_approved ON tributes(is_approved);

-- è‡ªåŠ¨æ›´æ–° updated_at çš„è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_memorials_updated_at BEFORE UPDATE ON memorials
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_subscriptions_updated_at BEFORE UPDATE ON subscriptions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

**ä»»åŠ¡æ¸…å•**:
- [ ] åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ Schema
- [ ] éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ
- [ ] éªŒè¯ RLS ç­–ç•¥ç”Ÿæ•ˆ
- [ ] æµ‹è¯•åŸºæœ¬çš„ CRUD æ“ä½œ

**äº§å‡ºæ–‡ä»¶**:
- [ ] `.claude/database-schema.sql` - å®Œæ•´çš„æ•°æ®åº“ Schema
- [ ] `.claude/database-documentation.md` - æ•°æ®åº“æ–‡æ¡£

---

### 1.4 UI ç»„ä»¶åº“æ­å»º

#### å®‰è£… Shadcn UI

```bash
npx shadcn@latest init
```

**é…ç½®é€‰é¡¹**:
- Style: Default
- Base color: Slate
- CSS variables: Yes

#### å®‰è£…æ ¸å¿ƒç»„ä»¶

```bash
# å®‰è£…å¸¸ç”¨ç»„ä»¶
npx shadcn@latest add button
npx shadcn@latest add card
npx shadcn@latest add input
npx shadcn@latest add label
npx shadcn@latest add textarea
npx shadcn@latest add select
npx shadcn@latest add dialog
npx shadcn@latest add dropdown-menu
npx shadcn@latest add avatar
npx shadcn@latest add tabs
npx shadcn@latest add toast
npx shadcn@latest add form
npx shadcn@latest add skeleton
```

#### å®‰è£…åŠ¨ç”»åº“

```bash
npm install framer-motion
```

#### è‡ªå®šä¹‰ç»„ä»¶

**åˆ›å»ºæƒ…æ„ŸåŒ–ç»„ä»¶**:

```typescript
// src/components/ui/candle.tsx
'use client'

import { motion } from 'framer-motion'

export function VirtualCandle({ onLight }: { onLight: () => void }) {
  return (
    <button
      onClick={onLight}
      className="relative group"
      aria-label="ç‚¹äº®èœ¡çƒ›"
    >
      <motion.div
        className="w-16 h-20 bg-amber-100 rounded-t-lg"
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
      >
        <motion.div
          className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2"
          animate={{
            scale: [1, 1.1, 1],
            opacity: [0.8, 1, 0.8],
          }}
          transition={{
            duration: 2,
            repeat: Infinity,
            ease: "easeInOut"
          }}
        >
          <div className="w-6 h-8 bg-gradient-to-t from-amber-400 via-orange-400 to-yellow-300 rounded-full blur-sm" />
        </motion.div>
      </motion.div>
    </button>
  )
}

// src/components/ui/flower.tsx
'use client'

import { motion } from 'framer-motion'

type FlowerType = 'rose' | 'lily' | 'chrysanthemum' | 'tulip'

const flowerEmojis: Record<FlowerType, string> = {
  rose: 'ğŸŒ¹',
  lily: 'ğŸŒ¸',
  chrysanthemum: 'ğŸŒ¼',
  tulip: 'ğŸŒ·',
}

export function VirtualFlower({
  type,
  onOffer
}: {
  type: FlowerType
  onOffer: (type: FlowerType) => void
}) {
  return (
    <motion.button
      onClick={() => onOffer(type)}
      className="text-4xl"
      whileHover={{ scale: 1.2, rotate: 10 }}
      whileTap={{ scale: 0.9 }}
      aria-label={`çŒ®ä¸Š${type}`}
    >
      {flowerEmojis[type]}
    </motion.button>
  )
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® Shadcn UI
- [ ] å®‰è£…æ ¸å¿ƒç»„ä»¶
- [ ] åˆ›å»ºè‡ªå®šä¹‰æƒ…æ„ŸåŒ–ç»„ä»¶
- [ ] åˆ›å»ºå¸ƒå±€ç»„ä»¶ï¼ˆHeader, Footer, Containerï¼‰
- [ ] åˆ›å»ºåŠ è½½çŠ¶æ€ç»„ä»¶

**äº§å‡ºæ–‡ä»¶**:
- [ ] `src/components/ui/*` - UI ç»„ä»¶åº“
- [ ] `src/components/layout/*` - å¸ƒå±€ç»„ä»¶
- [ ] `.claude/component-library.md` - ç»„ä»¶ä½¿ç”¨æ–‡æ¡£

---

### 1.5 é¡¹ç›®ç»“æ„ä¼˜åŒ–

#### åˆ›å»ºæ¨èçš„ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/              # è®¤è¯ç›¸å…³è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”œâ”€â”€ register/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ (dashboard)/         # Dashboard è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ memorials/           # çºªå¿µé¡µè·¯ç”±
â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ memorials/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/              # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                 # UI ç»„ä»¶ï¼ˆShadcnï¼‰
â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ memorials/          # çºªå¿µé¡µç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ auth/               # è®¤è¯ç›¸å…³ç»„ä»¶
â”œâ”€â”€ lib/                     # å·¥å…·åº“
â”‚   â”œâ”€â”€ supabase/           # Supabase å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ design-tokens.ts    # è®¾è®¡ Token
â”‚   â””â”€â”€ validations.ts      # æ•°æ®éªŒè¯
â”œâ”€â”€ types/                   # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ database.ts         # æ•°æ®åº“ç±»å‹
â”‚   â””â”€â”€ index.ts            # é€šç”¨ç±»å‹
â””â”€â”€ hooks/                   # è‡ªå®šä¹‰ React Hooks
    â”œâ”€â”€ use-auth.ts
    â””â”€â”€ use-memorial.ts
```

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºç›®å½•ç»“æ„
- [ ] åˆ›å»ºç±»å‹å®šä¹‰æ–‡ä»¶
- [ ] åˆ›å»ºå·¥å…·å‡½æ•°æ–‡ä»¶
- [ ] æ›´æ–° tsconfig.json çš„ path åˆ«å

```json
// tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/types/*": ["./src/types/*"],
      "@/hooks/*": ["./src/hooks/*"]
    }
  }
}
```

---

### é˜¶æ®µ 1 éªŒæ”¶æ ‡å‡†

**å®Œæˆæ ‡å‡†**:
- âœ… è®¾è®¡ç³»ç»Ÿæ–‡æ¡£å®Œæ•´ï¼Œè‰²å½©/å­—ä½“/é—´è·å·²å®šä¹‰
- âœ… Supabase é¡¹ç›®é…ç½®å®Œæˆï¼Œå¯ä»¥è¿æ¥æ•°æ®åº“
- âœ… æ•°æ®åº“ Schema åˆ›å»ºæˆåŠŸï¼ŒRLS ç­–ç•¥ç”Ÿæ•ˆ
- âœ… UI ç»„ä»¶åº“å®‰è£…å®Œæˆï¼Œè‡ªå®šä¹‰ç»„ä»¶å¯ç”¨
- âœ… é¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œç±»å‹å®šä¹‰å®Œæ•´

**äº§å‡ºæ–‡ä»¶æ¸…å•**:
- [ ] `.claude/design-system.md`
- [ ] `.claude/database-schema.sql`
- [ ] `.claude/database-documentation.md`
- [ ] `.claude/component-library.md`
- [ ] `src/lib/design-tokens.ts`
- [ ] `src/lib/supabase/client.ts`
- [ ] `src/lib/supabase/server.ts`
- [ ] `src/types/database.ts`

**Git Commit**:
```bash
git add .
git commit -m "feat: complete phase 1 - infrastructure setup

- Define design system with emotional color palette
- Configure Supabase backend
- Create database schema with RLS policies
- Set up Shadcn UI component library
- Establish project structure"
```

---

## é˜¶æ®µ 2: ç”¨æˆ·ç³»ç»Ÿ

**ç›®æ ‡**: å®ç°ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€Dashboard å’Œè´¦æˆ·ç®¡ç†åŠŸèƒ½

**æ—¶é—´ä¼°ç®—**: 5-7 å¤©

### 2.1 è®¤è¯ç³»ç»Ÿ

#### 2.1.1 Supabase Auth é…ç½®

**é…ç½® Supabase Auth**:
- [ ] åœ¨ Supabase Dashboard å¯ç”¨ Email Provider
- [ ] é…ç½®é‚®ä»¶æ¨¡æ¿ï¼ˆæ³¨å†Œç¡®è®¤ã€å¯†ç é‡ç½®ï¼‰
- [ ] å¯ç”¨ Google OAuthï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®é‡å®šå‘ URLs

**ç¯å¢ƒå˜é‡**:
```bash
# .env.local
NEXT_PUBLIC_SITE_URL=http://localhost:3000
NEXT_PUBLIC_SUPABASE_REDIRECT_URL=http://localhost:3000/auth/callback
```

#### 2.1.2 è®¤è¯é¡µé¢å®ç°

**æ³¨å†Œé¡µé¢**:

```typescript
// src/app/(auth)/register/page.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { useToast } from '@/hooks/use-toast'

export default function RegisterPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [name, setName] = useState('')
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleRegister = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: { name },
          emailRedirectTo: `${window.location.origin}/auth/callback`,
        },
      })

      if (error) throw error

      toast({
        title: 'æ³¨å†ŒæˆåŠŸ',
        description: 'è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±ä»¥éªŒè¯è´¦æˆ·',
      })

      router.push('/login')
    } catch (error) {
      toast({
        title: 'æ³¨å†Œå¤±è´¥',
        description: error.message,
        variant: 'destructive',
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-primary-50">
      <div className="w-full max-w-md space-y-8 rounded-lg bg-white p-8 shadow-lg">
        <div className="text-center">
          <h1 className="text-3xl font-semibold text-neutral-800">
            åˆ›å»ºè´¦æˆ·
          </h1>
          <p className="mt-2 text-neutral-600">
            ä¸ºæ‚¨çš„å® ç‰©å»ºç«‹æ°¸æ’çš„çºªå¿µç©ºé—´
          </p>
        </div>

        <form onSubmit={handleRegister} className="space-y-6">
          <div>
            <Label htmlFor="name">å§“å</Label>
            <Input
              id="name"
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
            />
          </div>

          <div>
            <Label htmlFor="email">é‚®ç®±</Label>
            <Input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>

          <div>
            <Label htmlFor="password">å¯†ç </Label>
            <Input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              minLength={6}
            />
          </div>

          <Button
            type="submit"
            className="w-full"
            disabled={loading}
          >
            {loading ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ'}
          </Button>
        </form>

        <p className="text-center text-sm text-neutral-600">
          å·²æœ‰è´¦æˆ·ï¼Ÿ{' '}
          <a href="/login" className="text-primary-600 hover:underline">
            ç«‹å³ç™»å½•
          </a>
        </p>
      </div>
    </div>
  )
}
```

**ç™»å½•é¡µé¢**:

```typescript
// src/app/(auth)/login/page.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { useToast } from '@/hooks/use-toast'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)

    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      })

      if (error) throw error

      router.push('/dashboard')
      router.refresh()
    } catch (error) {
      toast({
        title: 'ç™»å½•å¤±è´¥',
        description: error.message,
        variant: 'destructive',
      })
    } finally {
      setLoading(false)
    }
  }

  const handleGoogleLogin = async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/auth/callback`,
      },
    })

    if (error) {
      toast({
        title: 'ç™»å½•å¤±è´¥',
        description: error.message,
        variant: 'destructive',
      })
    }
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-primary-50">
      <div className="w-full max-w-md space-y-8 rounded-lg bg-white p-8 shadow-lg">
        <div className="text-center">
          <h1 className="text-3xl font-semibold text-neutral-800">
            æ¬¢è¿å›æ¥
          </h1>
          <p className="mt-2 text-neutral-600">
            ç™»å½•è®¿é—®æ‚¨çš„çºªå¿µç©ºé—´
          </p>
        </div>

        <form onSubmit={handleLogin} className="space-y-6">
          <div>
            <Label htmlFor="email">é‚®ç®±</Label>
            <Input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>

          <div>
            <Label htmlFor="password">å¯†ç </Label>
            <Input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>

          <div className="text-right">
            <a
              href="/forgot-password"
              className="text-sm text-primary-600 hover:underline"
            >
              å¿˜è®°å¯†ç ï¼Ÿ
            </a>
          </div>

          <Button
            type="submit"
            className="w-full"
            disabled={loading}
          >
            {loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•'}
          </Button>
        </form>

        <div className="relative">
          <div className="absolute inset-0 flex items-center">
            <div className="w-full border-t border-neutral-300" />
          </div>
          <div className="relative flex justify-center text-sm">
            <span className="bg-white px-2 text-neutral-600">æˆ–</span>
          </div>
        </div>

        <Button
          type="button"
          variant="outline"
          className="w-full"
          onClick={handleGoogleLogin}
        >
          ä½¿ç”¨ Google ç™»å½•
        </Button>

        <p className="text-center text-sm text-neutral-600">
          è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ{' '}
          <a href="/register" className="text-primary-600 hover:underline">
            ç«‹å³æ³¨å†Œ
          </a>
        </p>
      </div>
    </div>
  )
}
```

**Auth Callback å¤„ç†**:

```typescript
// src/app/auth/callback/route.ts
import { NextResponse } from 'next/server'
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function GET(request: Request) {
  const requestUrl = new URL(request.url)
  const code = requestUrl.searchParams.get('code')

  if (code) {
    const cookieStore = await cookies()
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          get(name: string) {
            return cookieStore.get(name)?.value
          },
          set(name: string, value: string, options: any) {
            cookieStore.set({ name, value, ...options })
          },
          remove(name: string, options: any) {
            cookieStore.delete({ name, ...options })
          },
        },
      }
    )

    await supabase.auth.exchangeCodeForSession(code)
  }

  return NextResponse.redirect(`${requestUrl.origin}/dashboard`)
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® Supabase Auth
- [ ] å®ç°æ³¨å†Œé¡µé¢
- [ ] å®ç°ç™»å½•é¡µé¢
- [ ] å®ç° Google OAuthï¼ˆå¯é€‰ï¼‰
- [ ] å®ç°å¯†ç é‡ç½®é¡µé¢
- [ ] å®ç° Auth Callback å¤„ç†
- [ ] åˆ›å»ºå—ä¿æŠ¤è·¯ç”±ä¸­é—´ä»¶

---

### 2.2 ç”¨æˆ· Dashboard

#### 2.2.1 Dashboard å¸ƒå±€

```typescript
// src/app/(dashboard)/layout.tsx
import { redirect } from 'next/navigation'
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { DashboardNav } from '@/components/dashboard/nav'

export default async function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const supabase = await createServerSupabaseClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/login')
  }

  return (
    <div className="min-h-screen bg-neutral-50">
      <DashboardNav user={user} />
      <main className="container mx-auto px-4 py-8">
        {children}
      </main>
    </div>
  )
}
```

#### 2.2.2 Dashboard ä¸»é¡µ

```typescript
// src/app/(dashboard)/dashboard/page.tsx
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { MemorialCard } from '@/components/memorials/memorial-card'
import { Button } from '@/components/ui/button'
import Link from 'next/link'

export default async function DashboardPage() {
  const supabase = await createServerSupabaseClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  const { data: memorials } = await supabase
    .from('memorials')
    .select('*')
    .eq('user_id', user!.id)
    .order('created_at', { ascending: false })

  return (
    <div className="space-y-8">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-semibold text-neutral-800">
            æˆ‘çš„çºªå¿µé¡µ
          </h1>
          <p className="mt-2 text-neutral-600">
            ç®¡ç†æ‚¨ä¸ºå® ç‰©åˆ›å»ºçš„çºªå¿µç©ºé—´
          </p>
        </div>
        <Link href="/memorials/create">
          <Button size="lg">
            åˆ›å»ºçºªå¿µé¡µ
          </Button>
        </Link>
      </div>

      {memorials && memorials.length > 0 ? (
        <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {memorials.map((memorial) => (
            <MemorialCard key={memorial.id} memorial={memorial} />
          ))}
        </div>
      ) : (
        <div className="rounded-lg border-2 border-dashed border-neutral-300 p-12 text-center">
          <h3 className="text-lg font-medium text-neutral-800">
            è¿˜æ²¡æœ‰çºªå¿µé¡µ
          </h3>
          <p className="mt-2 text-neutral-600">
            ä¸ºæ‚¨çš„å® ç‰©åˆ›å»ºç¬¬ä¸€ä¸ªçºªå¿µç©ºé—´
          </p>
          <Link href="/memorials/create">
            <Button className="mt-4">
              å¼€å§‹åˆ›å»º
            </Button>
          </Link>
        </div>
      )}
    </div>
  )
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º Dashboard å¸ƒå±€
- [ ] åˆ›å»º Dashboard å¯¼èˆªç»„ä»¶
- [ ] å®ç° Dashboard ä¸»é¡µ
- [ ] åˆ›å»ºçºªå¿µé¡µå¡ç‰‡ç»„ä»¶
- [ ] å®ç°è´¦æˆ·è®¾ç½®é¡µé¢

---

### é˜¶æ®µ 2 éªŒæ”¶æ ‡å‡†

**å®Œæˆæ ‡å‡†**:
- âœ… ç”¨æˆ·å¯ä»¥æ³¨å†Œå¹¶æ”¶åˆ°éªŒè¯é‚®ä»¶
- âœ… ç”¨æˆ·å¯ä»¥ç™»å½•å’Œç™»å‡º
- âœ… Google OAuth ç™»å½•å¯ç”¨ï¼ˆå¯é€‰ï¼‰
- âœ… Dashboard å¯ä»¥æ˜¾ç¤ºç”¨æˆ·çš„çºªå¿µé¡µåˆ—è¡¨
- âœ… å—ä¿æŠ¤è·¯ç”±æ­£å¸¸å·¥ä½œ

**æµ‹è¯•æ¸…å•**:
- [ ] æµ‹è¯•æ³¨å†Œæµç¨‹
- [ ] æµ‹è¯•ç™»å½•æµç¨‹
- [ ] æµ‹è¯•å¯†ç é‡ç½®
- [ ] æµ‹è¯•å—ä¿æŠ¤è·¯ç”±é‡å®šå‘
- [ ] æµ‹è¯• Dashboard æ•°æ®åŠ è½½

**Git Commit**:
```bash
git add .
git commit -m "feat: complete phase 2 - user authentication system

- Implement email registration and login
- Add Google OAuth integration
- Create user dashboard with memorial list
- Set up protected routes with middleware
- Add account management pages"
```

---

## é˜¶æ®µ 3: çºªå¿µé¡µæ ¸å¿ƒåŠŸèƒ½

**ç›®æ ‡**: å®ç°çºªå¿µé¡µåˆ›å»ºã€å±•ç¤ºã€ç…§ç‰‡ä¸Šä¼ ã€è™šæ‹Ÿæ‚¼å¿µå’Œç•™è¨€åŠŸèƒ½

**æ—¶é—´ä¼°ç®—**: 10-14 å¤©

### 3.1 çºªå¿µé¡µåˆ›å»ºæµç¨‹

#### 3.1.1 ä¸‰æ­¥å‘å¯¼è®¾è®¡

**æ­¥éª¤ 1: åŸºæœ¬ä¿¡æ¯**
- å® ç‰©åå­—
- å“ç§
- ç‰©ç§ï¼ˆç‹—/çŒ«/é¸Ÿ/å…¶ä»–ï¼‰
- ç”Ÿæ—¥å’Œç¦»ä¸–æ—¥æœŸ

**æ­¥éª¤ 2: ç…§ç‰‡ä¸Šä¼ **
- æ‹–æ‹½ä¸Šä¼ 
- å¤šé€‰ä¸Šä¼ 
- ç…§ç‰‡é¢„è§ˆå’Œæ’åº
- æœ€å°‘ 1 å¼ ç…§ç‰‡

**æ­¥éª¤ 3: ç”Ÿå¹³æ•…äº‹**
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- ç”Ÿå¹³æ•…äº‹
- çºªå¿µæ–‡
- æä¾›å†™ä½œæ¨¡æ¿

#### 3.1.2 å®ç°ä»£ç 

```typescript
// src/app/memorials/create/page.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { createClient } from '@/lib/supabase/client'
import { StepIndicator } from '@/components/memorials/step-indicator'
import { BasicInfoStep } from '@/components/memorials/create/basic-info-step'
import { PhotoUploadStep } from '@/components/memorials/create/photo-upload-step'
import { StoryStep } from '@/components/memorials/create/story-step'
import { Button } from '@/components/ui/button'
import { useToast } from '@/hooks/use-toast'

type Memorial = {
  petName: string
  petBreed: string
  petSpecies: string
  birthDate: string
  deathDate: string
  photos: File[]
  bio: string
  memorialText: string
  privacy: 'public' | 'private' | 'unlisted'
}

export default function CreateMemorialPage() {
  const [currentStep, setCurrentStep] = useState(1)
  const [memorial, setMemorial] = useState<Partial<Memorial>>({
    privacy: 'public',
  })
  const [loading, setLoading] = useState(false)
  const router = useRouter()
  const { toast } = useToast()
  const supabase = createClient()

  const steps = [
    { number: 1, name: 'åŸºæœ¬ä¿¡æ¯', component: BasicInfoStep },
    { number: 2, name: 'ç…§ç‰‡ä¸Šä¼ ', component: PhotoUploadStep },
    { number: 3, name: 'ç”Ÿå¹³æ•…äº‹', component: StoryStep },
  ]

  const CurrentStepComponent = steps[currentStep - 1].component

  const handleNext = () => {
    if (currentStep < 3) {
      setCurrentStep(currentStep + 1)
    }
  }

  const handleBack = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1)
    }
  }

  const handleSubmit = async () => {
    setLoading(true)

    try {
      // 1. ç”Ÿæˆ slug
      const slug = generateSlug(memorial.petName!, memorial.petBreed!)

      // 2. åˆ›å»ºçºªå¿µé¡µè®°å½•
      const { data: memorialData, error: memorialError } = await supabase
        .from('memorials')
        .insert({
          pet_name: memorial.petName,
          pet_breed: memorial.petBreed,
          pet_species: memorial.petSpecies,
          birth_date: memorial.birthDate,
          death_date: memorial.deathDate,
          bio: memorial.bio,
          memorial_text: memorial.memorialText,
          slug,
          privacy: memorial.privacy,
        })
        .select()
        .single()

      if (memorialError) throw memorialError

      // 3. ä¸Šä¼ ç…§ç‰‡
      if (memorial.photos && memorial.photos.length > 0) {
        for (let i = 0; i < memorial.photos.length; i++) {
          const file = memorial.photos[i]
          const fileExt = file.name.split('.').pop()
          const fileName = `${memorialData.id}/${Date.now()}-${i}.${fileExt}`

          // ä¸Šä¼ åˆ° Supabase Storage
          const { error: uploadError } = await supabase.storage
            .from('memorial-photos')
            .upload(fileName, file)

          if (uploadError) throw uploadError

          // è·å–å…¬å¼€ URL
          const { data: urlData } = supabase.storage
            .from('memorial-photos')
            .getPublicUrl(fileName)

          // ä¿å­˜ç…§ç‰‡è®°å½•
          await supabase.from('photos').insert({
            memorial_id: memorialData.id,
            url: urlData.publicUrl,
            display_order: i,
          })
        }
      }

      toast({
        title: 'çºªå¿µé¡µåˆ›å»ºæˆåŠŸ',
        description: 'æ‚¨å·²ä¸ºå® ç‰©åˆ›å»ºäº†æ°¸æ’çš„çºªå¿µç©ºé—´',
      })

      router.push(`/memorials/${slug}`)
    } catch (error) {
      toast({
        title: 'åˆ›å»ºå¤±è´¥',
        description: error.message,
        variant: 'destructive',
      })
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="min-h-screen bg-primary-50 py-12">
      <div className="container mx-auto max-w-3xl px-4">
        <div className="mb-8 text-center">
          <h1 className="text-3xl font-semibold text-neutral-800">
            åˆ›å»ºçºªå¿µé¡µ
          </h1>
          <p className="mt-2 text-neutral-600">
            ä¸ºæ‚¨çš„å® ç‰©å»ºç«‹æ°¸æ’çš„çºªå¿µç©ºé—´
          </p>
        </div>

        <StepIndicator steps={steps} currentStep={currentStep} />

        <div className="mt-8 rounded-lg bg-white p-8 shadow-lg">
          <CurrentStepComponent
            memorial={memorial}
            onChange={setMemorial}
          />

          <div className="mt-8 flex justify-between">
            <Button
              type="button"
              variant="outline"
              onClick={handleBack}
              disabled={currentStep === 1}
            >
              ä¸Šä¸€æ­¥
            </Button>

            {currentStep < 3 ? (
              <Button onClick={handleNext}>
                ä¸‹ä¸€æ­¥
              </Button>
            ) : (
              <Button onClick={handleSubmit} disabled={loading}>
                {loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºçºªå¿µé¡µ'}
              </Button>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

function generateSlug(petName: string, petBreed: string): string {
  const date = new Date().getFullYear()
  const slug = `${petName}-${petBreed}-${date}`
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '')
  return slug
}
```

**å„æ­¥éª¤ç»„ä»¶å®ç°çœç•¥ï¼ˆå¤ªé•¿ï¼‰ï¼Œæ–‡æ¡£ä¸­ä¼šåˆ—å‡ºå®Œæ•´çš„ä»£ç **

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°æ­¥éª¤æŒ‡ç¤ºå™¨ç»„ä»¶
- [ ] å®ç°åŸºæœ¬ä¿¡æ¯è¡¨å•
- [ ] å®ç°ç…§ç‰‡ä¸Šä¼ ç»„ä»¶ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
- [ ] å®ç°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- [ ] å®ç° Slug ç”Ÿæˆé€»è¾‘
- [ ] é…ç½® Supabase Storage
- [ ] å®ç°ç…§ç‰‡ä¸Šä¼ åˆ° Storage
- [ ] æ·»åŠ è¡¨å•éªŒè¯

---

### 3.2 çºªå¿µé¡µå±•ç¤º

#### 3.2.1 çºªå¿µé¡µå¸ƒå±€è®¾è®¡

```typescript
// src/app/memorials/[slug]/page.tsx
import { notFound } from 'next/navigation'
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { PhotoGallery } from '@/components/memorials/photo-gallery'
import { VirtualTribute } from '@/components/memorials/virtual-tribute'
import { TributeList } from '@/components/memorials/tribute-list'
import { TributeForm } from '@/components/memorials/tribute-form'

export async function generateMetadata({ params }: { params: { slug: string } }) {
  const supabase = await createServerSupabaseClient()

  const { data: memorial } = await supabase
    .from('memorials')
    .select('*')
    .eq('slug', params.slug)
    .single()

  if (!memorial) return {}

  return {
    title: `${memorial.pet_name} (${memorial.pet_breed}) çš„çºªå¿µé¡µ`,
    description: memorial.bio?.slice(0, 160),
    openGraph: {
      title: `çºªå¿µ ${memorial.pet_name}`,
      description: memorial.bio?.slice(0, 160),
    },
  }
}

export default async function MemorialPage({
  params,
}: {
  params: { slug: string }
}) {
  const supabase = await createServerSupabaseClient()

  // è·å–çºªå¿µé¡µä¿¡æ¯
  const { data: memorial } = await supabase
    .from('memorials')
    .select(`
      *,
      photos (*)
    `)
    .eq('slug', params.slug)
    .single()

  if (!memorial) {
    notFound()
  }

  // è·å–å·²æ‰¹å‡†çš„ç•™è¨€
  const { data: tributes } = await supabase
    .from('tributes')
    .select('*')
    .eq('memorial_id', memorial.id)
    .eq('is_approved', true)
    .order('created_at', { ascending: false })

  // å¢åŠ è®¿é—®è®¡æ•°
  await supabase
    .from('memorials')
    .update({ view_count: memorial.view_count + 1 })
    .eq('id', memorial.id)

  return (
    <div className="min-h-screen bg-primary-50">
      {/* Hero Section */}
      <div className="bg-gradient-to-b from-primary-100 to-primary-50 py-16">
        <div className="container mx-auto max-w-4xl px-4 text-center">
          <h1 className="text-4xl font-semibold text-neutral-800">
            {memorial.pet_name}
          </h1>
          <p className="mt-2 text-xl text-neutral-600">
            {memorial.pet_breed}
          </p>
          <p className="mt-4 text-neutral-600">
            {formatDate(memorial.birth_date)} - {formatDate(memorial.death_date)}
          </p>
        </div>
      </div>

      <div className="container mx-auto max-w-4xl px-4 py-12">
        {/* Photo Gallery */}
        <section className="mb-12">
          <PhotoGallery photos={memorial.photos} />
        </section>

        {/* Bio */}
        {memorial.bio && (
          <section className="mb-12 rounded-lg bg-white p-8 shadow-md">
            <h2 className="mb-4 text-2xl font-semibold text-neutral-800">
              ç”Ÿå¹³æ•…äº‹
            </h2>
            <div className="prose prose-lg max-w-none text-neutral-700">
              {memorial.bio}
            </div>
          </section>
        )}

        {/* Memorial Text */}
        {memorial.memorial_text && (
          <section className="mb-12 rounded-lg bg-primary-50 p-8">
            <h2 className="mb-4 text-2xl font-semibold text-neutral-800">
              çºªå¿µæ–‡
            </h2>
            <div className="prose max-w-none italic text-neutral-700">
              {memorial.memorial_text}
            </div>
          </section>
        )}

        {/* Virtual Tribute */}
        <section className="mb-12">
          <VirtualTribute
            memorialId={memorial.id}
            candleCount={memorial.candle_count}
            flowerCount={memorial.flower_count}
          />
        </section>

        {/* Tribute Form */}
        <section className="mb-12 rounded-lg bg-white p-8 shadow-md">
          <h2 className="mb-4 text-2xl font-semibold text-neutral-800">
            ç•™ä¸‹æ‚¨çš„æ‚¼å¿µ
          </h2>
          <TributeForm memorialId={memorial.id} />
        </section>

        {/* Tribute List */}
        <section>
          <h2 className="mb-6 text-2xl font-semibold text-neutral-800">
            æ‚¼å¿µç•™è¨€ ({tributes?.length || 0})
          </h2>
          <TributeList tributes={tributes || []} />
        </section>
      </div>
    </div>
  )
}

function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°çºªå¿µé¡µå¸ƒå±€
- [ ] å®ç°ç…§ç‰‡ç”»å»Šç»„ä»¶ï¼ˆè½®æ’­+ç½‘æ ¼ï¼‰
- [ ] å®ç°è™šæ‹Ÿæ‚¼å¿µç»„ä»¶ï¼ˆèœ¡çƒ›+é²œèŠ±ï¼‰
- [ ] å®ç°ç•™è¨€è¡¨å•
- [ ] å®ç°ç•™è¨€åˆ—è¡¨
- [ ] æ·»åŠ  SEO meta æ ‡ç­¾
- [ ] å®ç°è®¿é—®è®¡æ•°
- [ ] æ·»åŠ åˆ†äº«åŠŸèƒ½

---

### 3.3 ç…§ç‰‡ä¸Šä¼ ä¸ç®¡ç†

#### Supabase Storage é…ç½®

**åˆ›å»º Storage Bucket**:
- [ ] åœ¨ Supabase Dashboard åˆ›å»º `memorial-photos` bucket
- [ ] è®¾ç½®ä¸º Public bucket
- [ ] é…ç½® RLS ç­–ç•¥

```sql
-- Storage RLS ç­–ç•¥
CREATE POLICY "Users can upload photos to own memorials"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'memorial-photos' AND
  (storage.foldername(name))[1] IN (
    SELECT id::text FROM memorials WHERE user_id = auth.uid()
  )
);

CREATE POLICY "Anyone can view public memorial photos"
ON storage.objects FOR SELECT
USING (bucket_id = 'memorial-photos');
```

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® Storage Bucket
- [ ] å®ç°å›¾ç‰‡å‹ç¼©ï¼ˆclient-sideï¼‰
- [ ] å®ç°æ‹–æ‹½ä¸Šä¼ 
- [ ] å®ç°ç…§ç‰‡æ’åº
- [ ] å®ç°ç…§ç‰‡åˆ é™¤
- [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

---

### é˜¶æ®µ 3 éªŒæ”¶æ ‡å‡†

**å®Œæˆæ ‡å‡†**:
- âœ… ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‰æ­¥å‘å¯¼åˆ›å»ºçºªå¿µé¡µ
- âœ… ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- âœ… çºªå¿µé¡µå±•ç¤ºç¾è§‚ä¸”å“åº”å¼
- âœ… è™šæ‹Ÿèœ¡çƒ›å’Œé²œèŠ±åŠ¨ç”»æµç•…
- âœ… ç•™è¨€åŠŸèƒ½å¯ç”¨ï¼ˆéœ€å®¡æ ¸ï¼‰
- âœ… SEO meta æ ‡ç­¾æ­£ç¡®

**æµ‹è¯•æ¸…å•**:
- [ ] æµ‹è¯•åˆ›å»ºçºªå¿µé¡µå®Œæ•´æµç¨‹
- [ ] æµ‹è¯•ç…§ç‰‡ä¸Šä¼ ï¼ˆå•ä¸ªã€å¤šä¸ªã€æ‹–æ‹½ï¼‰
- [ ] æµ‹è¯•çºªå¿µé¡µåœ¨ä¸åŒè®¾å¤‡ä¸Šçš„å±•ç¤º
- [ ] æµ‹è¯•è™šæ‹Ÿæ‚¼å¿µäº’åŠ¨
- [ ] æµ‹è¯•ç•™è¨€æäº¤
- [ ] éªŒè¯ SEO meta æ ‡ç­¾

**Git Commit**:
```bash
git add .
git commit -m "feat: complete phase 3 - memorial core features

- Implement 3-step memorial creation wizard
- Add photo upload with drag-and-drop
- Create memorial display page with beautiful layout
- Add virtual candle and flower tribute animations
- Implement tribute message system with moderation
- Add SEO optimization for memorial pages"
```

---

## é˜¶æ®µ 4: å½©è™¹æ¡¥æ•…äº‹å¢™

**ç›®æ ‡**: å®ç°é¦–é¡µå…¬å…±çºªå¿µé¡µå±•ç¤ºï¼ˆç€‘å¸ƒæµå¸ƒå±€ï¼‰

**æ—¶é—´ä¼°ç®—**: 5-7 å¤©

### 4.1 é¦–é¡µè®¾è®¡

```typescript
// src/app/page.tsx
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { RainbowBridgeWall } from '@/components/home/rainbow-bridge-wall'
import { Hero } from '@/components/home/hero'
import { Button } from '@/components/ui/button'
import Link from 'next/link'

export default async function HomePage() {
  const supabase = await createServerSupabaseClient()

  // è·å–å…¬å¼€çš„çºªå¿µé¡µ
  const { data: memorials } = await supabase
    .from('memorials')
    .select(`
      id,
      pet_name,
      pet_breed,
      pet_species,
      birth_date,
      death_date,
      bio,
      slug,
      view_count,
      candle_count,
      flower_count,
      photos!inner (
        url,
        thumbnail_url
      )
    `)
    .eq('privacy', 'public')
    .order('created_at', { ascending: false })
    .limit(30)

  return (
    <div className="min-h-screen">
      {/* Hero Section */}
      <Hero />

      {/* Rainbow Bridge Wall */}
      <section className="bg-primary-50 py-16">
        <div className="container mx-auto px-4">
          <div className="mb-12 text-center">
            <h2 className="text-3xl font-semibold text-neutral-800">
              å½©è™¹æ¡¥æ•…äº‹å¢™
            </h2>
            <p className="mt-4 text-lg text-neutral-600">
              çºªå¿µé‚£äº›é™ªä¼´æˆ‘ä»¬çš„æ°¸è¿œçš„æœ‹å‹
            </p>
          </div>

          <RainbowBridgeWall memorials={memorials || []} />

          <div className="mt-12 text-center">
            <Link href="/memorials">
              <Button size="lg" variant="outline">
                æŸ¥çœ‹æ›´å¤šçºªå¿µé¡µ
              </Button>
            </Link>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="bg-gradient-to-b from-primary-100 to-white py-16">
        <div className="container mx-auto max-w-3xl px-4 text-center">
          <h2 className="text-3xl font-semibold text-neutral-800">
            ä¸ºæ‚¨çš„å® ç‰©åˆ›å»ºçºªå¿µé¡µ
          </h2>
          <p className="mt-4 text-lg text-neutral-600">
            å»ºç«‹ä¸€ä¸ªæ¸©æš–ã€æ°¸ä¹…çš„çºªå¿µç©ºé—´ï¼Œè®©çˆ±ä¸å›å¿†æ°¸å­˜
          </p>
          <Link href="/memorials/create">
            <Button size="lg" className="mt-8">
              å¼€å§‹åˆ›å»º
            </Button>
          </Link>
        </div>
      </section>
    </div>
  )
}
```

### 4.2 ç€‘å¸ƒæµå¸ƒå±€å®ç°

```typescript
// src/components/home/rainbow-bridge-wall.tsx
'use client'

import { useState } from 'react'
import { MemorialCard } from './memorial-card'
import Masonry from 'react-masonry-css'

type Memorial = {
  id: string
  pet_name: string
  pet_breed: string
  pet_species: string
  birth_date: string
  death_date: string
  bio: string
  slug: string
  photos: { url: string }[]
}

export function RainbowBridgeWall({ memorials }: { memorials: Memorial[] }) {
  const [sortBy, setSortBy] = useState<'latest' | 'popular'>('latest')

  const sortedMemorials = [...memorials].sort((a, b) => {
    if (sortBy === 'latest') {
      return new Date(b.death_date).getTime() - new Date(a.death_date).getTime()
    } else {
      return b.view_count - a.view_count
    }
  })

  const breakpointColumns = {
    default: 3,
    1024: 2,
    640: 1,
  }

  return (
    <div>
      {/* Sort Controls */}
      <div className="mb-8 flex justify-center gap-4">
        <button
          onClick={() => setSortBy('latest')}
          className={`rounded-full px-6 py-2 ${
            sortBy === 'latest'
              ? 'bg-primary-600 text-white'
              : 'bg-white text-neutral-700'
          }`}
        >
          æœ€æ–°åˆ›å»º
        </button>
        <button
          onClick={() => setSortBy('popular')}
          className={`rounded-full px-6 py-2 ${
            sortBy === 'popular'
              ? 'bg-primary-600 text-white'
              : 'bg-white text-neutral-700'
          }`}
        >
          æœ€å¤šè®¿é—®
        </button>
      </div>

      {/* Masonry Grid */}
      <Masonry
        breakpointCols={breakpointColumns}
        className="flex -ml-6 w-auto"
        columnClassName="pl-6 bg-clip-padding"
      >
        {sortedMemorials.map((memorial) => (
          <MemorialCard key={memorial.id} memorial={memorial} />
        ))}
      </Masonry>
    </div>
  )
}
```

**å®‰è£…ä¾èµ–**:
```bash
npm install react-masonry-css
```

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° Hero ç»„ä»¶
- [ ] å®ç°ç€‘å¸ƒæµå¸ƒå±€
- [ ] åˆ›å»ºçºªå¿µé¡µå¡ç‰‡ç»„ä»¶
- [ ] å®ç°æ’åºåŠŸèƒ½ï¼ˆæœ€æ–°/æœ€çƒ­ï¼‰
- [ ] å®ç°æ— é™æ»šåŠ¨ï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ åŠ è½½éª¨æ¶å±
- [ ] ä¼˜åŒ–é¦–é¡µæ€§èƒ½ï¼ˆISRï¼‰

---

### é˜¶æ®µ 4 éªŒæ”¶æ ‡å‡†

**å®Œæˆæ ‡å‡†**:
- âœ… é¦–é¡µå±•ç¤ºå…¬å¼€çºªå¿µé¡µ
- âœ… ç€‘å¸ƒæµå¸ƒå±€ç¾è§‚ä¸”å“åº”å¼
- âœ… æ’åºåŠŸèƒ½æ­£å¸¸
- âœ… é¦–é¡µåŠ è½½é€Ÿåº¦å¿«ï¼ˆ< 2sï¼‰
- âœ… ç§»åŠ¨ç«¯ä½“éªŒè‰¯å¥½

**Git Commit**:
```bash
git add .
git commit -m "feat: complete phase 4 - rainbow bridge memorial wall

- Implement homepage with hero section
- Create masonry grid layout for memorial wall
- Add sorting functionality (latest/popular)
- Optimize homepage performance with ISR
- Ensure responsive design across devices"
```

---

## é˜¶æ®µ 5: å†…å®¹ç®¡ç†ä¸ä¼˜åŒ–

**ç›®æ ‡**: SEO ä¼˜åŒ–ã€æ€§èƒ½ä¼˜åŒ–ã€å†…å®¹å®¡æ ¸ã€æµ‹è¯•å’Œéƒ¨ç½²

**æ—¶é—´ä¼°ç®—**: 5-7 å¤©

### 5.1 SEO ä¼˜åŒ–

#### Sitemap ç”Ÿæˆ

```typescript
// src/app/sitemap.ts
import { MetadataRoute } from 'next'
import { createServerSupabaseClient } from '@/lib/supabase/server'

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const supabase = await createServerSupabaseClient()

  // è·å–æ‰€æœ‰å…¬å¼€çºªå¿µé¡µ
  const { data: memorials } = await supabase
    .from('memorials')
    .select('slug, updated_at')
    .eq('privacy', 'public')

  const memorialUrls = memorials?.map((memorial) => ({
    url: `https://wplacegrasswonder.memorial/memorials/${memorial.slug}`,
    lastModified: new Date(memorial.updated_at),
    changeFrequency: 'monthly' as const,
    priority: 0.8,
  })) || []

  return [
    {
      url: 'https://wplacegrasswonder.memorial',
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
    },
    ...memorialUrls,
  ]
}
```

#### Robots.txt

```typescript
// src/app/robots.ts
import { MetadataRoute } from 'next'

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
      disallow: ['/dashboard', '/api', '/admin'],
    },
    sitemap: 'https://wplacegrasswonder.memorial/sitemap.xml',
  }
}
```

#### Schema.org ç»“æ„åŒ–æ•°æ®

```typescript
// src/components/memorials/memorial-schema.tsx
export function MemorialSchema({ memorial }: { memorial: Memorial }) {
  const schema = {
    '@context': 'https://schema.org',
    '@type': 'Person',
    name: memorial.pet_name,
    birthDate: memorial.birth_date,
    deathDate: memorial.death_date,
    description: memorial.bio,
    image: memorial.photos[0]?.url,
  }

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}
    />
  )
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° sitemap.xml ç”Ÿæˆ
- [ ] é…ç½® robots.txt
- [ ] æ·»åŠ  Schema.org ç»“æ„åŒ–æ•°æ®
- [ ] ä¼˜åŒ– meta æ ‡ç­¾
- [ ] é…ç½® Open Graph æ ‡ç­¾
- [ ] æ·»åŠ  Google Analytics
- [ ] æäº¤åˆ° Google Search Console

---

### 5.2 æ€§èƒ½ä¼˜åŒ–

#### Next.js é…ç½®ä¼˜åŒ–

```typescript
// next.config.ts
import type { NextConfig } from 'next'

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '*.supabase.co',
      },
    ],
    formats: ['image/avif', 'image/webp'],
  },
  experimental: {
    optimizePackageImports: ['@/components'],
  },
}

export default nextConfig
```

**ä»»åŠ¡æ¸…å•**:
- [ ] å›¾ç‰‡ä¼˜åŒ–ï¼ˆNext.js Imageï¼‰
- [ ] ä»£ç åˆ†å‰²
- [ ] æ‡’åŠ è½½éå…³é”®ç»„ä»¶
- [ ] é…ç½® ISRï¼ˆå¢é‡é™æ€å†ç”Ÿï¼‰
- [ ] æ·»åŠ åŠ è½½çŠ¶æ€
- [ ] ä¼˜åŒ–å­—ä½“åŠ è½½
- [ ] Lighthouse å®¡è®¡å¹¶ä¿®å¤é—®é¢˜

**æ€§èƒ½ç›®æ ‡**:
- Lighthouse Performance: > 90
- LCP (Largest Contentful Paint): < 2.5s
- FID (First Input Delay): < 100ms
- CLS (Cumulative Layout Shift): < 0.1

---

### 5.3 å†…å®¹å®¡æ ¸ç³»ç»Ÿ

```typescript
// src/app/admin/tributes/page.tsx
import { createServerSupabaseClient } from '@/lib/supabase/server'
import { TributeModerationTable } from '@/components/admin/tribute-moderation-table'

export default async function TributeModerationPage() {
  const supabase = await createServerSupabaseClient()

  // è·å–å¾…å®¡æ ¸ç•™è¨€
  const { data: pendingTributes } = await supabase
    .from('tributes')
    .select(`
      *,
      memorials (
        pet_name,
        slug
      )
    `)
    .eq('is_approved', false)
    .order('created_at', { ascending: false })

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="mb-8 text-3xl font-semibold">
        ç•™è¨€å®¡æ ¸ ({pendingTributes?.length || 0})
      </h1>

      <TributeModerationTable tributes={pendingTributes || []} />
    </div>
  )
}
```

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºç®¡ç†å‘˜é¡µé¢
- [ ] å®ç°ç•™è¨€å®¡æ ¸é˜Ÿåˆ—
- [ ] æ·»åŠ æ‰¹å‡†/æ‹’ç»åŠŸèƒ½
- [ ] å®ç°å…³é”®è¯è¿‡æ»¤ï¼ˆé»‘åå•ï¼‰
- [ ] æ·»åŠ ä¸¾æŠ¥åŠŸèƒ½
- [ ] åˆ›å»ºå®¡æ ¸æ—¥å¿—

---

### 5.4 æµ‹è¯•ä¸éƒ¨ç½²

#### æµ‹è¯•æ¸…å•

**åŠŸèƒ½æµ‹è¯•**:
- [ ] ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- [ ] çºªå¿µé¡µåˆ›å»ºå®Œæ•´æµç¨‹
- [ ] ç…§ç‰‡ä¸Šä¼ 
- [ ] è™šæ‹Ÿæ‚¼å¿µäº’åŠ¨
- [ ] ç•™è¨€æäº¤
- [ ] Dashboard åŠŸèƒ½
- [ ] è´¦æˆ·è®¾ç½®

**å“åº”å¼æµ‹è¯•**:
- [ ] ç§»åŠ¨ç«¯ï¼ˆ< 640pxï¼‰
- [ ] å¹³æ¿ç«¯ï¼ˆ640px - 1024pxï¼‰
- [ ] æ¡Œé¢ç«¯ï¼ˆ> 1024pxï¼‰

**æµè§ˆå™¨æµ‹è¯•**:
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

**æ€§èƒ½æµ‹è¯•**:
- [ ] Lighthouse å®¡è®¡
- [ ] é¦–é¡µåŠ è½½æ—¶é—´
- [ ] çºªå¿µé¡µåŠ è½½æ—¶é—´
- [ ] å›¾ç‰‡åŠ è½½ä¼˜åŒ–

#### éƒ¨ç½²åˆ° Vercel

```bash
# 1. å®‰è£… Vercel CLI
npm install -g vercel

# 2. ç™»å½• Vercel
vercel login

# 3. éƒ¨ç½²
vercel --prod
```

**ç¯å¢ƒå˜é‡é…ç½®**:
åœ¨ Vercel Dashboard é…ç½®:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `NEXT_PUBLIC_SITE_URL`

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½® Vercel é¡¹ç›®
- [ ] è®¾ç½®ç¯å¢ƒå˜é‡
- [ ] é…ç½®è‡ªå®šä¹‰åŸŸå
- [ ] é…ç½® SSL è¯ä¹¦
- [ ] è®¾ç½® CI/CDï¼ˆè‡ªåŠ¨éƒ¨ç½²ï¼‰
- [ ] é…ç½®é”™è¯¯ç›‘æ§ï¼ˆSentryï¼‰
- [ ] é…ç½® Uptime ç›‘æ§

---

### é˜¶æ®µ 5 éªŒæ”¶æ ‡å‡†

**å®Œæˆæ ‡å‡†**:
- âœ… SEO ä¼˜åŒ–å®Œæˆï¼ˆsitemap, robots.txt, schemaï¼‰
- âœ… æ€§èƒ½è¾¾æ ‡ï¼ˆLighthouse > 90ï¼‰
- âœ… å†…å®¹å®¡æ ¸ç³»ç»Ÿå¯ç”¨
- âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… è‡ªå®šä¹‰åŸŸåé…ç½®å®Œæˆ

**æœ€ç»ˆæµ‹è¯•**:
- [ ] å®Œæ•´ç”¨æˆ·æ—…ç¨‹æµ‹è¯•
- [ ] SEO éªŒè¯ï¼ˆGoogle Search Consoleï¼‰
- [ ] æ€§èƒ½ç›‘æ§è®¾ç½®
- [ ] é”™è¯¯ç›‘æ§éªŒè¯

**Git Commit**:
```bash
git add .
git commit -m "feat: complete phase 5 - optimization and deployment

- Implement SEO optimization (sitemap, robots, schema)
- Optimize performance (images, code splitting, ISR)
- Add content moderation system for tributes
- Configure Vercel deployment
- Add monitoring and analytics
- Achieve Lighthouse score > 90"
```

---

## æ£€æŸ¥æ¸…å•

### MVP å®Œæˆæ£€æŸ¥æ¸…å•

#### æ ¸å¿ƒåŠŸèƒ½
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œå’Œç™»å½•
- [ ] ç”¨æˆ·å¯ä»¥åˆ›å»ºçºªå¿µé¡µï¼ˆä¸‰æ­¥å‘å¯¼ï¼‰
- [ ] ç”¨æˆ·å¯ä»¥ä¸Šä¼ ç…§ç‰‡ï¼ˆè‡³å°‘ 1 å¼ ï¼‰
- [ ] ç”¨æˆ·å¯ä»¥ç¼–å†™ç”Ÿå¹³æ•…äº‹å’Œçºªå¿µæ–‡
- [ ] çºªå¿µé¡µå¯ä»¥å…¬å¼€å±•ç¤º
- [ ] è®¿å®¢å¯ä»¥ç‚¹äº®èœ¡çƒ›
- [ ] è®¿å®¢å¯ä»¥çŒ®èŠ±
- [ ] è®¿å®¢å¯ä»¥ç•™è¨€ï¼ˆéœ€å®¡æ ¸ï¼‰
- [ ] é¦–é¡µå±•ç¤ºå½©è™¹æ¡¥æ•…äº‹å¢™
- [ ] ç®¡ç†å‘˜å¯ä»¥å®¡æ ¸ç•™è¨€

#### æŠ€æœ¯è¦æ±‚
- [ ] å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰
- [ ] Lighthouse Performance > 85
- [ ] SEO ä¼˜åŒ–ï¼ˆmeta, sitemap, schemaï¼‰
- [ ] æ•°æ®åº“ RLS ç­–ç•¥æ­£ç¡®
- [ ] å›¾ç‰‡ä¸Šä¼ å’Œå­˜å‚¨æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤º

#### è®¾è®¡è¦æ±‚
- [ ] è‰²å½©ç³»ç»ŸæŸ”å’Œæ¸©æš–
- [ ] å­—ä½“æ˜“è¯»ï¼ˆ18px åŸºå‡†ï¼‰
- [ ] å¤§é‡ç•™ç™½ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
- [ ] åœ†è§’è®¾è®¡ï¼ˆ8-12pxï¼‰
- [ ] åŠ¨ç”»æµç•…ï¼ˆ300-500msï¼‰
- [ ] æƒ…æ„ŸåŒ–æ–‡æ¡ˆï¼ˆé¿å…"æ­»äº¡"ç­‰è¯ï¼‰

#### éƒ¨ç½²è¦æ±‚
- [ ] æˆåŠŸéƒ¨ç½²åˆ° Vercel
- [ ] è‡ªå®šä¹‰åŸŸåé…ç½®
- [ ] SSL è¯ä¹¦æœ‰æ•ˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] ç›‘æ§å’Œåˆ†æå·¥å…·é…ç½®

---

## é£é™©ä¸æ³¨æ„äº‹é¡¹

### æŠ€æœ¯é£é™©

**1. Supabase é…é¢é™åˆ¶**
- å…è´¹å¥—é¤é™åˆ¶ï¼š500MB æ•°æ®åº“ï¼Œ1GB å­˜å‚¨
- åº”å¯¹ï¼šç›‘æ§ä½¿ç”¨é‡ï¼ŒåŠæ—¶å‡çº§

**2. å›¾ç‰‡å­˜å‚¨æˆæœ¬**
- ç”¨æˆ·ä¸Šä¼ å¤§é‡é«˜æ¸…ç…§ç‰‡
- åº”å¯¹ï¼šå®¢æˆ·ç«¯å‹ç¼©ï¼Œé™åˆ¶å•å¼ å¤§å°

**3. æ€§èƒ½é—®é¢˜**
- é¦–é¡µåŠ è½½å¤§é‡çºªå¿µé¡µå¡ç‰‡
- åº”å¯¹ï¼šåˆ†é¡µåŠ è½½ï¼ŒISR ä¼˜åŒ–

### è®¾è®¡é£é™©

**1. æƒ…æ„Ÿè®¾è®¡å¤±è¡¡**
- è¿‡äºæ‚²ä¼¤æˆ–è¿‡äºè½»æµ®
- åº”å¯¹ï¼šç”¨æˆ·æµ‹è¯•ï¼Œæ”¶é›†åé¦ˆ

**2. æ–‡æ¡ˆä¸å½“**
- ä½¿ç”¨ä¸æ•æ„Ÿè¯æ±‡
- åº”å¯¹ï¼šä»”ç»†å®¡æŸ¥æ‰€æœ‰æ–‡æ¡ˆ

### å®‰å…¨é£é™©

**1. å†…å®¹å®¡æ ¸ä¸åŠæ—¶**
- ä¸å½“ç•™è¨€æœªå®¡æ ¸
- åº”å¯¹ï¼šè‡ªåŠ¨è¿‡æ»¤ + äººå·¥å®¡æ ¸

**2. ç”¨æˆ·éšç§æ³„éœ²**
- ç§å¯†çºªå¿µé¡µè¢«è®¿é—®
- åº”å¯¹ï¼šRLS ç­–ç•¥éªŒè¯

---

## åç»­è¿­ä»£è®¡åˆ’

### MVP åä¼˜åŒ–ï¼ˆç¬¬ 4-6 ä¸ªæœˆï¼‰

**åŠŸèƒ½å¢å¼º**:
- [ ] ä»˜è´¹åŠŸèƒ½ï¼ˆé«˜çº§æ¨¡æ¿ã€æ— é™ç…§ç‰‡ï¼‰
- [ ] çºªå¿µæ—¥æé†’
- [ ] çºªå¿µé¡µç¼–è¾‘åŠŸèƒ½
- [ ] ç…§ç‰‡æ’åºå’Œåˆ é™¤
- [ ] åšå®¢ç³»ç»Ÿï¼ˆæ‚²ä¼¤ç–å¯¼æ–‡ç« ï¼‰

**æ€§èƒ½ä¼˜åŒ–**:
- [ ] CDN åŠ é€Ÿ
- [ ] å›¾ç‰‡ç¼©ç•¥å›¾ç”Ÿæˆ
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥

**ç¤¾åŒºåŠŸèƒ½ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰**:
- [ ] æ‚²ä¼¤æ”¯æŒè®ºå›
- [ ] ç§ä¿¡ç³»ç»Ÿ
- [ ] ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ

---

## æ€»ç»“

è¿™ä¸ªå®æ–½è®¡åˆ’å°† plan.md çš„æ„¿æ™¯è½¬åŒ–ä¸ºå…·ä½“çš„å¼€å‘ä»»åŠ¡ã€‚æ•´ä¸ª MVP é¢„è®¡éœ€è¦ 6-8 å‘¨å®Œæˆã€‚

**å…³é”®æˆåŠŸå› ç´ **:
1. **å…±æƒ…è®¾è®¡** - æ¯ä¸ªç»†èŠ‚éƒ½è€ƒè™‘ç”¨æˆ·çš„æ‚²ä¼¤æƒ…ç»ª
2. **æ¸è¿›å¼å‘å¸ƒ** - MVP å…ˆéªŒè¯æ ¸å¿ƒä»·å€¼
3. **ç”¨æˆ·åé¦ˆ** - æŒç»­æ”¶é›†åé¦ˆå¹¶è¿­ä»£
4. **æ€§èƒ½ä¼˜å…ˆ** - å¿«é€ŸåŠ è½½ï¼Œæµç•…ä½“éªŒ
5. **å†…å®¹è´¨é‡** - SEO å†…å®¹ + UGC åŒå¼•æ“

**è¯·æ‚¨å®¡æ ¸æ­¤è®¡åˆ’ï¼Œç¡®è®¤æ— è¯¯åæˆ‘å°†å¼€å§‹åˆ†é˜¶æ®µæ‰§è¡Œã€‚**
